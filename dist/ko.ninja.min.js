!function(e,t){"function"==typeof define&&define.amd?define("ko.ninja.extend",["underscore"],t):t(e._,e.ko)}(this,function(e,t){var i=function(t,i){var n,r,o=this;return r=t&&e.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},e.extend(r,o,i),n=function(){this.constructor=r},n.prototype=o.prototype,r.prototype=new n,t&&e.extend(r.prototype,t),r.__super__=o.prototype,t.name&&(r.prototype.toString=function(){return t.name}),r};return"function"==typeof define&&define.amd?i:(t.ninjaExtend=i,void 0)}),function(e,t){"function"==typeof define&&define.amd?define("ko.ninja.events",["underscore"],t):t(e._,e.ko)}(this,function(e,t){var i,n,r,o,s=/\s+/;return n=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)e[t].apply(e,[r,i[r]].concat(n));return!1}if(s.test(i)){for(var o=i.split(s),a=0,u=o.length;u>a;a++)e[t].apply(e,[o[a]].concat(n));return!1}return!0},o=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t)}},i={on:function(e,t,i){if(!n(this,"on",e,[t,i])||!t)return this;this._events=this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:i,ctx:i||this}),this},once:function(t,i,r){if(!n(this,"once",t,[i,r])||!i)return this;var o=this,s=e.once(function(){o.off(t,s),i.apply(this,arguments)});return s._callback=i,this.on(t,s,r)},off:function(t,i,r){var o,s,a,u,l,c,d,h;if(!this._events||!n(this,"off",t,[i,r]))return this;if(!t&&!i&&!r)return this._events={},this;for(u=t?[t]:e.keys(this._events),l=0,c=u.length;c>l;l++)if(t=u[l],a===this._events[t]){if(this._events[t]=o=[],i||r)for(d=0,h=a.length;h>d;d++)s=a[d],(i&&i!==s.callback&&i!==s.callback._callback||r&&r!==s.context)&&o.push(s);o.length||delete this._events[t]}return this},trigger:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!n(this,"trigger",e,t))return this;var i=this._events[e],r=this._events.all;return i&&o(i,t),r&&o(r,arguments),this},stopListening:function(e,t,i){var n=this._listeners;if(!n)return this;var r=!t&&!i;"object"==typeof t&&(i=this),e&&((n={})[e._listenerId]=e);for(var o in n)n[o].off(t,i,this),r&&delete this._listeners[o];return this}},r={listenTo:"on",listenToOnce:"once"},e.each(r,function(t,n){i[n]=function(i,n,r){var o=this._listeners||(this._listeners={}),s=i._listenerId||(i._listenerId=e.uniqueId("l"));return o[s]=i,"object"==typeof n&&(r=this),i[t](n,r,this),this}}),"function"==typeof define&&define.amd?i:(t.ninjaEvents=i,void 0)}),function(e,t){"function"==typeof define&&define.amd?define("ko.ninja.baseModel",["underscore","ko.ninja.events","ko.ninja.extend"],t):t(e._,e.ko.ninjaEvents,e.ko.ninjaExtend,e.ko)}(this,function(e,t,i,n){var r=function(i){i=i||{},e.isFunction(this.initialize)&&this.initialize(i),e.extend(this,t,{idAttribute:"id",invalid:function(){return localStorage?this.name?void 0:{error:!0,message:"This model has no name. Every model needs a name"}:{error:!0,message:"There is no localStorage available in this context"}},save:function(e,t){return e[this.idAttribute]?this.update(e[this.idAttribute],e,t):this.insert(e,t)}},i)};return r.extend=i,"function"==typeof define&&define.amd?r:(n.ninjaBaseModel=r,void 0)}),function(e,t){"function"==typeof define&&define.amd?define("ko.ninja.localStorageModel",["ko.ninja.baseModel"],t):t(e.ko.ninjaBaseModel,e.ko)}(this,function(e,t){var i=e.extend({find:function(e,t){var i,n=[];if(t=t||e,this.invalid())t(this.invalid(e));else{for(var r in localStorage)if(~r.indexOf(this.name+"-")){i=!0;for(var o in e)e[o]!==JSON.parse(localStorage[r])[o]&&(i=!1);i&&n.push(JSON.parse(localStorage.getItem(r)))}t(n)}},findOne:function(e,t){this.invalid()?t(this.invalid()):t(JSON.parse(localStorage[this.name+"-"+e]||"{}"))},insert:function(e,t){t=t||function(){},e[this.idAttribute]=(new Date).getTime(),this.invalid(e)?t(this.invalid(e)):(localStorage[this.name+"-"+e.id]=JSON.stringify(e),t(e))},remove:function(e,t){t=t||function(){},this.invalid()?t(this.invalid()):(delete localStorage[this.name+"-"+e],t(null))},update:function(e,t,i){i=i||function(){},this.invalid(t)?i(this.invalid(t)):(t[this.idAttribute]=e,localStorage[this.name+"-"+e]=JSON.stringify(t),i(t))}});return"function"==typeof define&&define.amd?i:(t.ninjaLocalStorageModel=i,void 0)}),define("ko.ninja.validator",["underscore"],function(e){return{supported_rules:["required","minLength","maxLength","numeric","email"],validate:function(t,i){var n=this;i=i||{};var r=[];return e.find(i,function(e,i){if(n.supported_rules.indexOf(i)<0)return!1;var o=n.rules[i].call(this,e,t);o!==!0&&r.push({rule:i,description:o})}),r},rules:{required:function(t,i){return t!==!0?!0:e.isNull(i)||""===i?"This is a required field.":!0},maxLength:function(e,t){return t&&t.length<=e?!0:"The maximum length allowed is "+e+" characters."},minLength:function(e,t){return t&&t.length>=e?!0:"The minimum length allowed is "+e+" characters."},string:function(t,i){return e.isString(i)?!0:"This value must be a string."},alpha:function(e,t){return/[^a-zA-Z0-9]/.test(t)?!0:"This value must contain only alphabetic characters."},numeric:function(t,i){return e.isNumber(i)?!0:"This value must be numeric."},alphanumeric:function(e,t){return/[^a-zA-Z0-9]/.test(t)?!0:"This value must be alphanumeric."},email:function(e,t){var i=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return i.test(t)?!0:"This value must be a valid email address."},url:function(){return!0},urlish:function(){return!0},ip:function(){return!0},ipv4:function(){return!0},ipv6:function(){return!0},creditcard:function(){return!0},"int":function(e,t){return this.integer(e,t)},integer:function(t,i){return e.isNumber(i)&&Math.floor(i)===i?!0:"This value must be an integer."},number:function(t,i){return e.isNumber(i)?!0:"This value must be a number."},decimal:function(){return!0},"float":function(){return!0},falsey:function(e,t){return t?"This value must be 'falsey.'":!0},truthy:function(e,t){return t?!0:"This value must be 'truthy.'"},"boolean":function(t,i){return e.isBoolean(i)?!0:"This value must be a boolean."},date:function(){return!0},hexColor:function(){return!0},lowercase:function(e,t){var i=t.toLowerCase();return i===t?!0:"This value must be entirely lowercase."},uppercase:function(e,t){var i=t.toUpperCase();return i===t?!0:"This value must be entirely uppercase."},min:function(e,t){return t>=e?!0:"The minimum allowed value is: "+e},max:function(e,t){return e>=t?!0:"The maximum allowed value is: "+e},regex:function(){return!0},notRegex:function(){return!0},equals:function(e,t){return t===e?!0:"Required value: "+e},"in":function(e,t){return e.indexOf(t)<0?"The follow values are allowed: "+e.join(", "):!0},notIn:function(e,t){return e.indexOf(t)>=0?"The follow values are not allowed: "+e.join(", "):!0}}}}),define("esperanto/main",["require","exports","module","underscore"],function(e){var t=e("underscore"),i=function(){return this.init.apply(this,t.toArray(arguments)),{where:this.internalAPI.where.bind(this),findWhere:this.internalAPI.findWhere.bind(this),save:this.internalAPI.save.bind(this),create:this.internalAPI.create.bind(this),destroy:this.internalAPI.destroy.bind(this),getAllModels:this.internalAPI.getAllModels.bind(this)}};return t.extend(i.prototype,{source:"localStorage",supportedSources:["localStorage","sessionStorage"],init:function(e){e&&this.setSource(e),this.initStorage()},setSource:function(e){if(this.supportedSources.indexOf(e)<0)throw"Invalid data source specified: "+e},initStorage:function(){switch(this.source){case"localStorage":var t=new e("./lib/localStorage");this.internalAPI=new t;break;case"sessionStorage":this.internalAPI=new e("./lib/sessionStorage")}}}),i}),define("esperanto",["esperanto/main"],function(e){return e}),define("ko.ninja.deferred",[],function(){var e=function(){this.callbacks=[]};return e.prototype={err:0,x:0,$:function(e){return this.callbacks.push(e),2===this.x&&this._(this.o),this},done:function(e){return this.$([e,0])},fail:function(e){return this.$([0,e])},always:function(e){return this.$([0,0,e])},promise:function(e,t){return this.$([e,t])},reject:function(e){return this.x||(this.err=1,this._(e)),this},resolve:function(e){return this.x||this._(e),this},_:function(t){this.x=1;for(var i=this.err,n=this.callbacks,r=n.shift(),o=t;r;)try{for(;r;){if((r=r[2]||(i?r[1]:r[0]))&&(o=r(o||t)),o instanceof e){var s=this;return o.always(function(e){return s._(e||t),e}),void 0}r=n.shift()}}catch(a){i&&(r=n.shift(),this.err=i=1)}this.o=o||t,this.x=2}},e.when=function(t,i){if(!i)return t;i=[].slice.call(arguments),t=new e;for(var n=i.length,r=n,o=[],s=function(e){return function(i){o[e]=i,--r||t.resolve(o)}},a=function(e){t.reject(e)};n--;)i[n].then(s(n),a);return t},e}),define("ko.ninja.utils",["underscore","knockout","ko.ninja.deferred"],function(e,t,i){return{generateUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})},initObservables:function(){var i=this;e.each(this.observables,function(n,r){e.isFunction(n)?i[r]=t.computed({read:n,deferEvaluation:!0,owner:i}):e.isArray(n)?i[r]=t.observableArray(n):e.isObject(n)&&n.read?(n.owner=i,i[r]=t.computed(n)):i[r]=t.observable(n)})},deferred:function(e){return"object"==typeof window.$?$.Deferred(e):new i(e)}}}),define("ko.ninja.viewModel",["underscore","knockout","ko.ninja.extend","ko.ninja.localStorageModel","ko.ninja.validator","esperanto","ko.ninja.utils"],function(e,t,i,n,r,o,s){var a=function(){var t=e.first(e.toArray(arguments));this._initialize(t),this.initialize(t)};return e.extend(a.prototype,{observables:{},_initialize:function(i){var n=this;this.initObservables(),e.each(i,function(e,i){t.isObservable(n[i])&&n[i](e)})},initialize:function(){},initObservables:s.initObservables}),a.extend=i,a}),define("ko.ninja.model",["underscore","knockout","ko.ninja.extend","ko.ninja.localStorageModel","ko.ninja.validator","esperanto","ko.ninja.utils"],function(e,t,i,n,r,o,s){var a={models:{},getInstance:function(e,t){return this.models[e]?this.models[e][t]?this.models[e][t]:null:null},setInstance:function(e){if(!(e instanceof u))throw"Invalid model specified.";if(!e.id())throw"Model does not have a value set for id.";this.models[e.model]||(this.models[e.model]={}),this.models[e.model][e.id()]=e},removeInstance:function(e,t){return this.models[e]?(this.models[e][t]&&delete this.models[e][t],void 0):null},getAll:function(){return this.models}},u=function(){u.esperanto_initialized||u.initializeEsperanto();var t=e.toArray(arguments),i=e.first(t);if(e.isObject(i)&&!e.isArray(i));else if(e.isString(i)||e.isNumber(i)){var n={};n[this.idAttribute]=i,i=n}else{if(i)throw"Invalid model attributes specified.";i={}}var r={};r[this.idAttribute]=null,e.defaults(i,r);var o=a.getInstance(this.model,i[this.idAttribute]);return o?o:(t.splice(0,1,i),this._initialize.apply(this,t),e.isFunction(this.initialize)&&this.initialize.apply(this),void 0)};return u.storage={method:"localStorage"},u.esperanto_initialized=!1,u.initializeEsperanto=function(){switch(u.storage.method){case"localStorage":u.esperanto=new o("localStorage")}},e.extend(u.prototype,{idAttribute:"id",_initialize:function(i){var n=this;i._caller&&(this._caller=i._caller,delete i._caller),e.each(this.attributes,function(e,i){n[i]=t.observable(null),n[i+"_validation"]=t.observableArray(),n.validation_errors=t.computed(n.validationErrorCount,n),n[i].subscribe(function(){n.validate(i)})}),n[n.idAttribute]=t.observable(),"id"!==this.idAttribute&&(this.id=t.computed(function(){return n[n.idAttribute]()})),this[this.idAttribute].subscribe(function(e){e&&a.setInstance(n)}),this.initObservables(),e.each(i,function(e,t){n.set(t,e)}),this.collections&&e.each(this.collections,function(e,i){var n={_caller:this};n[this.idAttribute]=this[this.idAttribute](),this[i]=t.observable(new e(n))},this)},initObservables:s.initObservables,validationErrorCount:function(){var t=0,i=this.getValidationErrors();return e.each(i,function(e){t+=e.length}),t},getValidationErrors:function(){var i=this,n={},r=e.keys(this);return e.each(r,function(e){e.indexOf("_validation")>0&&i.hasOwnProperty(e)&&t.isObservable(i[e])&&(n[e.replace("_validation","")]=t.unwrap(i[e]))}),n},initialize:function(){},set:function(e,t){if(e===this.idAttribute);else if(!this.attributes[e])throw"The specified attribute has not been defined for this model: "+e;this[e](t)},get:function(e){return this.attributes[e]?t.unwrap(this[e]):void 0},validate:function(e){this[e+"_validation"](r.validate(t.unwrap(this[e]),this.attributes[e]||{}))},fetch:function(){var t=this,i=s.deferred();if(this.isNew())i.reject("This model is new and cannot be fetched from storage.");else if(this.storage);else{var n={};n[this.idAttribute]=this[this.idAttribute](),u.esperanto.findWhere(this.model,n).done(function(n){e.each(n,function(e,i){t.set(i,e)}),i.resolve(t)}).fail(function(e){i.reject(e)})}return i.promise()},create:function(){var e=this,t=s.deferred();if(this.validationErrorCount()>0)t.reject("Validation errors exist for this instance.");else{var i=this.toJSON();delete i[this.idAttribute],this.storage||u.esperanto.create(this.model,i).done(function(i){e.setID(i[e.idAttribute]),t.resolve()}).fail(function(){t.reject()})}return t.promise()},isNew:function(){return e.isNull(this.id())?!0:!1},equals:function(e){return this===e?!0:!1},update:function(){var e=this,t=s.deferred();if(this.validationErrorCount()>0)t.reject("Validation errors exist for this instance.");else{var i=this.toJSON();delete i[this.idAttribute],this.id()?u.esperanto.save(this.model,e.id(),i).done(function(i){e.setID(i[e.idAttribute]),t.resolve()}).fail(function(){t.reject()}):t.reject("This model is new and cannot be updated.")}return t.promise()},save:function(){var e=s.deferred();return this.validationErrorCount()>0?(e.reject("Validation errors exist for this instance."),e.promise()):this.id()?this.update():this.create()},serialize:function(){return JSON.stringify(this.toJSON())},toJSON:function(){var i=this,n={},r=e.keys(this.attributes);return e.each(r,function(e){n[e]=t.unwrap(i[e])}),n[i.idAttribute]=t.unwrap(i[i.idAttribute]),n},destroy:function(){var e=this,t=s.deferred();if(this.isNew())t.reject("This model is new and cannot be deleted.");else{var i=this.id();u.esperanto.destroy(this.model,i).done(function(){a.removeInstance(this.model,i),e.reset(),t.resolve(this)}).fail(function(e){t.reject(e)})}return t.promise()},setID:function(e){this[this.idAttribute](e)},reset:function(){var t=this;t[t.idAttribute](null),e.each(this.attributes,function(e,i){t[i](null)})},getPath:function(){var e="";return e+=this._caller?this._caller.getPath():"/"+this.model,e+="/"+this[this.idAttribute]()}}),u.extend=i,u.cache=a,u}),define("ko.ninja.collection",["underscore","knockout","ko.ninja.model","ko.ninja.extend","ko.ninja.localStorageModel","ko.ninja.validator","esperanto","ko.ninja.utils"],function(e,t,i,n,r){var o=function(t){t&&t._caller&&(this._caller=t._caller),this._initialize.apply(this,e.toArray(arguments))};return e.extend(o.prototype,{_initialize:function(){var e=this;this.models=t.observableArray(),this.models.subscribe(function(t){t._caller=e})},push:function(t){e.isArray(t)||(t=[t]);var n=this.models();e.each(t,function(t){if(t instanceof i)t._caller=this;else{if(!this.model)throw"Invalid model specified.";t=new this.model(e.extend(t,{_caller:this}))}n.indexOf(t)<0&&n.push(t)},this),this.models(n)},destroy:function(t){var n,o=r.deferred();if(e.isObject(t)&&t instanceof i)n=t.id();else{if(!e.isNumber(t)&&!e.isString(t))return o.reject("Invalid model specified."),void 0;n=t,t=null}if(t||(t=i.cache.getInstance(this.model,n)),!t)return o.resolve(this),void 0;var s=this.models();return t.destroy().done(function(){var e=s.indexOf(t);e>=0&&(s.splice(e,1),this.models(s)),o.resolve(this)}).fail(function(){o.reject("Unable to destroy model.")}),o.promise()},remove:function(t){var n;if(e.isObject(t)&&t instanceof i)n=t.id();else{if(!e.isNumber(t)&&!e.isString(t))throw"Invalid model specified.";n=t}var r=this.models(),o=r.indexOf(t);o>=0&&(r.splice(o,1),this.models(r))},getPath:function(){var e="";return this._caller&&(e+=this._caller.getPath()),e+="/"+this.collection}}),o.extend=n,o}),function(e,t){"function"==typeof define&&define.amd?define("ko.ninja",["underscore","knockout","ko.ninja.viewModel","ko.ninja.model","ko.ninja.collection"],t):t(e._,e.ko,e.ko.ninjaViewModel,e.ko.ninjaModel)}(this,function(e,t,i,n,r){return t.Collection=r,t.ViewModel=i,t.Model=n,t});
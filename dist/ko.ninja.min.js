!function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.events",["underscore"],e):e(t._,t.ko)}(this,function(t,e){var i,n,r,o,s=/\s+/;return n=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(s.test(i)){for(var o=i.split(s),a=0,u=o.length;u>a;a++)t[e].apply(t,[o[a]].concat(n));return!1}return!0},o=function(t,e){var i,n=-1,r=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e)}},i={on:function(t,e,i){if(!n(this,"on",t,[e,i])||!e)return this;this._events=this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:i,ctx:i||this}),this},once:function(e,i,r){if(!n(this,"once",e,[i,r])||!i)return this;var o=this,s=t.once(function(){o.off(e,s),i.apply(this,arguments)});return s._callback=i,this.on(e,s,r)},off:function(e,i,r){var o,s,a,u,l,c,h,d;if(!this._events||!n(this,"off",e,[i,r]))return this;if(!e&&!i&&!r)return this._events={},this;for(u=e?[e]:t.keys(this._events),l=0,c=u.length;c>l;l++)if(e=u[l],a===this._events[e]){if(this._events[e]=o=[],i||r)for(h=0,d=a.length;d>h;h++)s=a[h],(i&&i!==s.callback&&i!==s.callback._callback||r&&r!==s.context)&&o.push(s);o.length||delete this._events[e]}return this},trigger:function(t){if(!this._events)return this;var e=Array.prototype.slice.call(arguments,1);if(!n(this,"trigger",t,e))return this;var i=this._events[t],r=this._events.all;return i&&o(i,e),r&&o(r,arguments),this},stopListening:function(t,e,i){var n=this._listeners;if(!n)return this;var r=!e&&!i;"object"==typeof e&&(i=this),t&&((n={})[t._listenerId]=t);for(var o in n)n[o].off(e,i,this),r&&delete this._listeners[o];return this}},r={listenTo:"on",listenToOnce:"once"},t.each(r,function(e,n){i[n]=function(i,n,r){var o=this._listeners||(this._listeners={}),s=i._listenerId||(i._listenerId=t.uniqueId("l"));return o[s]=i,"object"==typeof n&&(r=this),i[e](n,r,this),this}}),"function"==typeof define&&define.amd?i:(e.ninjaEvents=i,void 0)}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.extend",["underscore"],e):e(t._,t.ko)}(this,function(t,e){var i=function(e,i){var n,r,o=this;return r=e&&t.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},t.extend(r,o,i),n=function(){this.constructor=r},n.prototype=o.prototype,r.prototype=new n,e&&t.extend(r.prototype,e),r.__super__=o.prototype,e.name&&(r.prototype.toString=function(){return e.name}),r};return"function"==typeof define&&define.amd?i:(e.ninjaExtend=i,void 0)}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.baseModel",["underscore","ko.ninja.events","ko.ninja.extend"],e):e(t._,t.ko.ninjaEvents,t.ko.ninjaExtend,t.ko)}(this,function(t,e,i,n){var r=function(i){i=i||{},t.isFunction(this.initialize)&&this.initialize(i),t.extend(this,e,{idAttribute:"id",invalid:function(){return localStorage?this.name?void 0:{error:!0,message:"This model has no name. Every model needs a name"}:{error:!0,message:"There is no localStorage available in this context"}},save:function(t,e){return t[this.idAttribute]?this.update(t[this.idAttribute],t,e):this.insert(t,e)}},i)};return r.extend=i,"function"==typeof define&&define.amd?r:(n.ninjaBaseModel=r,void 0)}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.localStorageModel",["ko.ninja.baseModel"],e):e(t.ko.ninjaBaseModel,t.ko)}(this,function(t,e){var i=t.extend({find:function(t,e){var i,n=[];if(e=e||t,this.invalid())e(this.invalid(t));else{for(var r in localStorage)if(~r.indexOf(this.name+"-")){i=!0;for(var o in t)t[o]!==JSON.parse(localStorage[r])[o]&&(i=!1);i&&n.push(JSON.parse(localStorage.getItem(r)))}e(n)}},findOne:function(t,e){this.invalid()?e(this.invalid()):e(JSON.parse(localStorage[this.name+"-"+t]||"{}"))},insert:function(t,e){e=e||function(){},t[this.idAttribute]=(new Date).getTime(),this.invalid(t)?e(this.invalid(t)):(localStorage[this.name+"-"+t.id]=JSON.stringify(t),e(t))},remove:function(t,e){e=e||function(){},this.invalid()?e(this.invalid()):(delete localStorage[this.name+"-"+t],e(null))},update:function(t,e,i){i=i||function(){},this.invalid(e)?i(this.invalid(e)):(e[this.idAttribute]=t,localStorage[this.name+"-"+t]=JSON.stringify(e),i(e))}});return"function"==typeof define&&define.amd?i:(e.ninjaLocalStorageModel=i,void 0)}),define("validator",["underscore"],function(t){return{supported_rules:["required","minLength","maxLength"],validate:function(e,i){var n=this;i=i||{};var r=[];return t.find(i,function(t,i){if(n.supported_rules.indexOf(i)<0)return!1;var o=n.rules[i].call(this,t,e);o!==!0&&r.push(o)}),r},rules:{required:function(e,i){return e!==!0?!0:t.isNull(i)||""===i?"This is a required field.":!0},maxLength:function(t,e){return e&&e.length<=t?!0:"The maximum length allowed is "+t+" characters."},minLength:function(t,e){return e&&e.length>=t?!0:"The minimum length allowed is "+t+" characters."},string:function(e,i){return t.isString(i)?!0:"This value must be a string."},alpha:function(t,e){return/[^a-zA-Z0-9]/.test(e)?!0:"This value must contain only alphabetic characters."},numeric:function(t,e){return/[^0-9]/.test(e)?!0:"This value must be numeric."},alphanumeric:function(t,e){return/[^a-zA-Z0-9]/.test(e)?!0:"This value must be alphanumeric."},email:function(t,e){var i=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return i.test(e)?!0:"This value must be a valid email address."},url:function(){return!0},urlish:function(){return!0},ip:function(){return!0},ipv4:function(){return!0},ipv6:function(){return!0},creditcard:function(){return!0},"int":function(t,e){return this.integer(t,e)},integer:function(e,i){return t.isNumber(i)&&Math.floor(i)===i?!0:"This value must be an integer."},number:function(e,i){return t.isNumber(i)?!0:"This value must be a number."},decimal:function(){return!0},"float":function(){return!0},falsey:function(t,e){return e?"This value must be 'falsey.'":!0},truthy:function(t,e){return e?!0:"This value must be 'truthy.'"},"boolean":function(e,i){return t.isBoolean(i)?!0:"This value must be a boolean."},date:function(){return!0},hexColor:function(){return!0},lowercase:function(t,e){var i=e.toLowerCase();return i===e?!0:"This value must be entirely lowercase."},uppercase:function(t,e){var i=e.toUpperCase();return i===e?!0:"This value must be entirely uppercase."},min:function(t,e){return e>=t?!0:"The minimum allowed value is: "+t},max:function(t,e){return t>=e?!0:"The maximum allowed value is: "+t},regex:function(){return!0},notRegex:function(){return!0},equals:function(t,e){return e===t?!0:"Required value: "+t},"in":function(t,e){return t.indexOf(e)<0?"The follow values are allowed: "+t.join(", "):!0},notIn:function(t,e){return t.indexOf(e)>=0?"The follow values are not allowed: "+t.join(", "):!0}}}}),define("esperanto/main",["require","exports","module","underscore"],function(t){var e=t("underscore"),i=function(){return this.init.apply(this,e.toArray(arguments)),{where:this.internalAPI.where.bind(this),findWhere:this.internalAPI.findWhere.bind(this),save:this.internalAPI.save.bind(this),create:this.internalAPI.create.bind(this),destroy:this.internalAPI.destroy.bind(this),getAllModels:this.internalAPI.getAllModels.bind(this)}};return e.extend(i.prototype,{source:"localStorage",supportedSources:["localStorage","sessionStorage"],init:function(t){t&&this.setSource(t),this.initStorage()},setSource:function(t){if(this.supportedSources.indexOf(t)<0)throw"Invalid data source specified: "+t},initStorage:function(){switch(this.source){case"localStorage":var e=new t("./lib/localStorage");this.internalAPI=new e;break;case"sessionStorage":this.internalAPI=new t("./lib/sessionStorage")}}}),i}),define("esperanto",["esperanto/main"],function(t){return t}),define("ko.ninja.deferred",[],function(){var t=function(){this.callbacks=[]};return t.prototype={err:0,x:0,$:function(t){return this.callbacks.push(t),2===this.x&&this._(this.o),this},done:function(t){return this.$([t,0])},fail:function(t){return this.$([0,t])},always:function(t){return this.$([0,0,t])},promise:function(t,e){return this.$([t,e])},reject:function(t){return this.x||(this.err=1,this._(t)),this},resolve:function(t){return this.x||this._(t),this},_:function(e){this.x=1;for(var i=this.err,n=this.callbacks,r=n.shift(),o=e;r;)try{for(;r;){if((r=r[2]||(i?r[1]:r[0]))&&(o=r(o||e)),o instanceof t){var s=this;return o.always(function(t){return s._(t||e),t}),void 0}r=n.shift()}}catch(a){i&&(r=n.shift(),this.err=i=1)}this.o=o||e,this.x=2}},t.when=function(e,i){if(!i)return e;i=[].slice.call(arguments),e=new t;for(var n=i.length,r=n,o=[],s=function(t){return function(i){o[t]=i,--r||e.resolve(o)}},a=function(t){e.reject(t)};n--;)i[n].then(s(n),a);return e},t}),define("ko.ninja.utils",["ko.ninja.deferred"],function(t){return{generateUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})},deferred:function(e){return"object"==typeof window.$?$.Deferred(e):new t(e)}}}),define("ko.ninja.model",["underscore","knockout","ko.ninja.extend","ko.ninja.localStorageModel","validator","esperanto","ko.ninja.utils"],function(t,e,i,n,r,o,s){var a={models:{},getInstance:function(t,e){return this.models[t]?this.models[t][e]?this.models[t][e]:null:null},setInstance:function(t){if(!(t instanceof u))throw"Invalid model specified.";if(!t.id())throw"Model does not have a value set for id.";this.models[t.model]||(this.models[t.model]={}),this.models[t.model][t.id()]=t},removeInstance:function(t,e){return this.models[t]?(this.models[t][e]&&delete this.models[t][e],void 0):null},getAll:function(){return this.models}},u=function(){u.esperanto_initialized||u.initializeEsperanto();var e=t.toArray(arguments),i=t.first(e);if(t.isObject(i)&&!t.isArray(i));else if(t.isString(i)||t.isNumber(i)){var n={};n[this.idAttribute]=i,i=n}else{if(i)throw"Invalid model attributes specified.";i={}}var r={};r[this.idAttribute]=null,t.defaults(i,r);var o=a.getInstance(this.model,i[this.idAttribute]);return o?o:(e.splice(0,1,i),this._initialize.apply(this,e),t.isFunction(this.initialize)&&this.initialize.apply(this),void 0)};return u.storage={method:"localStorage"},u.esperanto_initialized=!1,u.initializeEsperanto=function(){switch(u.storage.method){case"localStorage":u.esperanto=new o("localStorage")}},t.extend(u.prototype,{idAttribute:"id",_initialize:function(i){var n=this;t.each(this.attributes,function(t,i){n[i]=e.observable(null),n[i+"_validation"]=e.observableArray(),n.validation_errors=e.computed(n.validationErrorCount,n),n[i].subscribe(function(){n.validate(i)})}),n[n.idAttribute]=e.observable(),"id"!==this.idAttribute&&(this.id=e.computed(function(){return n[n.idAttribute]()})),this[this.idAttribute].subscribe(function(t){t&&a.setInstance(n)}),this.initObservables(),t.each(i,function(t,e){n.set(e,t)})},initObservables:function(){var i=this;t.each(this.observables,function(n,r){t.isFunction(n)?i[r]=e.computed({read:n,deferEvaluation:!0,owner:i}):t.isArray(n)?i[r]=e.observableArray(n):t.isObject(n)&&n.read?(n.owner=i,i[r]=e.computed(n)):i[r]=e.observable(n)})},validationErrorCount:function(){var e=0,i=this.getValidationErrors();return t.each(i,function(t){e+=t.length}),e},getValidationErrors:function(){var i=this,n={},r=t.keys(this);return t.each(r,function(t){t.indexOf("_validation")>0&&i.hasOwnProperty(t)&&e.isObservable(i[t])&&(n[t.replace("_validation","")]=e.unwrap(i[t]))}),n},initialize:function(){},set:function(t,e){if(t===this.idAttribute);else if(!this.attributes[t])throw"The specified attribute has not been defined for this model: "+t;this[t](e)},get:function(t){return this.attributes[t]?e.unwrap(this[t]):void 0},validate:function(t){this[t+"_validation"](r.validate(e.unwrap(this[t]),this.attributes[t]||{}))},fetch:function(){var e=this,i=s.deferred();if(this.isNew())i.reject("This model is new and cannot be fetched from storage.");else if(this.storage);else{var n={};n[this.idAttribute]=this[this.idAttribute](),u.esperanto.findWhere(this.model,n).done(function(n){t.each(n,function(t,i){e.set(i,t)}),i.resolve(e)}).fail(function(t){i.reject(t)})}return i.promise()},create:function(){var t=this,e=s.deferred();if(this.validationErrorCount()>0)e.reject("Validation errors exist for this instance.");else{var i=this.toJSON();delete i[this.idAttribute],this.storage||u.esperanto.create(this.model,i).done(function(i){t.setID(i[t.idAttribute]),e.resolve()}).fail(function(){e.reject()})}return e.promise()},isNew:function(){return t.isNull(this.id())?!0:!1},equals:function(t){return this===t?!0:!1},update:function(){var t=s.deferred();return this.validationErrorCount()>0?t.reject("Validation errors exist for this instance."):this.id()||t.reject("This model is new and cannot be updated."),t.promise()},save:function(){var t=s.deferred();if(this.validationErrorCount()>0)t.reject("Validation errors exist for this instance.");else{if(!this.id())return this.create();this.storage}return t.promise()},serialize:function(){return JSON.stringify(this.toJSON())},toJSON:function(){var i=this,n={},r=t.keys(this.attributes);return t.each(r,function(t){n[t]=e.unwrap(i[t])}),n[i.idAttribute]=e.unwrap(i[i.idAttribute]),n},destroy:function(){var t=s.deferred();if(this.isNew())t.reject("This model is new and cannot be deleted.");else{var e=this.id();u.esperanto.destroy(this.model,e).done(function(){a.removeInstance(this.model,e),t.resolve(this)}).fail(function(e){t.reject(e)})}return t.promise()},setID:function(t){this[this.idAttribute](t)}}),u.extend=i,u.cache=a,u}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.validation",["knockout","underscore"],e):e(t.ko,t._)}(this,function(t,e){var i={validationTypes:{_custom:function(t,e){return e.validator.call(this,t,e)},_maxLength:function(t,e){return t.length>e.value},_minLength:function(t,e){return t.length<e.value},_length:function(t,e){return t.length!==e.value},_required:function(t){return!t||!t.length},_email:function(t){return!/[^\s@]+@[^\s@]+\.[^\s@]+/.test(t)},_number:function(t){return!(!isNaN(parseFloat(t))&&isFinite(t))}},_validate:function(t,i){var n=this[i]?this[i]():null,r=[];return e.each(t,function(t,e){if(this.validationTypes["_"+e]){var o=this.validationTypes["_"+e].call(this,n,t);o&&("string"==typeof t&&(t={message:t}),r.push({observable:i,error:t.message}))}},this),r},validateOne:function(t){var e=this._validate(this.validation[t],t);return e.length?e[0].error:void 0},validateAll:function(){var t=[];return e.each(this.validation,function(e,i){t=t.concat(this._validate(e,i))},this),t},validate:function(){var t={};return this.errors(this.validateAll()),e.each(this.errors(),function(e){t[e.observable]||(this[e.observable].error(e.error),t[e.observable]=!0)},this),this.errors().length?this.errors():null},watchValidation:function(e){this[e]&&(this[e].error=t.observable(),this[e].subscribe(function(){this[e].error(this.validateOne(e)),this.errors(this.validateAll())}.bind(this)))},watchValidations:function(){this.errors=t.observableArray(),e.each(this.validation,function(t,e){this.watchValidation(e)},this)}};return"function"==typeof define&&define.amd?i:(t.ninjaValidation=i,void 0)}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja.viewModel",["knockout","underscore","ko.ninja.events","ko.ninja.extend","ko.ninja.model","ko.ninja.validation"],e):e(t.ko,t._,t.ko.ninjaEvents,t.ko.ninjaExtend,t.ko.ninjaModel,t.ko.ninjaValidation)}(this,function(t,e,i,n,r,o){var s=function(i){var n=e.functions(this.observables);n=e.reduce(this.observables,function(t,i,n){return e.isObject(i)&&!e.isArray(i)&&(i.read||i.write)&&t.push(n),t},n),e.each(e.omit(this.observables,n),function(n,r){this[r]=e.isArray(n)?t.isObservable(i[r])?i[r]:t.observableArray((i[r]||n).slice(0)):t.isObservable(i[r])?i[r]:t.observable(i[r]||n),this[r].subscribe(function(t){this.trigger("change:"+r,t)},this)},this),e.each(e.pick(this.observables,n),function(e,i){this[i]=t.computed({read:this.observables[i],write:function(){},owner:this},this)},this)},a=function(){},u=function(){var t=this,i=function(){var i={};e.each(t.observables,function(e,n){i[n]=t[n]()}),t.model.save(i,function(){})},n=e.debounce(i,1);this.model.status||(this.model=new r(this.model)),this.autoSync!==!1&&(this.autoSync=!0),this.fetch=function(t){var i=this,n=this.autoSync;this.autoSync=!1,this.model.findOne(this[this.idAttribute||"id"](),function(r){e.each(r,function(t,e){"function"==typeof i[e]&&i[e](t)}),i.autoSync=n,e.isFunction(t)&&t()})},e.each(this.observables,function(e,i){t[i].subscribe(function(){t.autoSync&&!t.validateAll().length&&n()})})},l=function(e){e=e||{},s.call(this,e),this.watchValidations(),this.validation&&a.call(this),this.initialize.apply(this,arguments),this.model&&u.call(this,e),this.autoSync&&this.fetch(),this.el&&t.applyBindings(this,"object"==typeof this.el?this.el:document.querySelector(this.el)[0])};return e.extend(l.prototype,i,o,{initialize:function(){}}),l.extend=n,"function"==typeof define&&define.amd?l:(t.ninjaViewModel=l,void 0)}),define("ko.ninja.collection",["underscore","knockout","ko.ninja.model","ko.ninja.extend","ko.ninja.localStorageModel","validator","esperanto","ko.ninja.utils"],function(t,e,i,n,r){var o=function(){this._initialize.apply(this,t.toArray(arguments))};return t.extend(o.prototype,{_initialize:function(){this.models=e.observableArray()},push:function(e){t.isArray(e)||(e=[e]);var n=this.models();t.each(e,function(t){if(!(t instanceof i))throw"Invalid model specified.";n.indexOf(t)<0&&n.push(t)}),this.models(n)},destroy:function(e){var n,o=r.deferred();if(t.isObject(e)&&e instanceof i)n=e.id();else{if(!t.isNumber(e)&&!t.isString(e))return o.reject("Invalid model specified."),void 0;n=e,e=null}if(e||(e=i.cache.getInstance(this.model,n)),!e)return o.resolve(this),void 0;var s=this.models();return e.destroy().done(function(){var t=s.indexOf(e);t>=0&&(s.splice(t,1),this.models(s)),o.resolve(this)}).fail(function(){o.reject("Unable to destroy model.")}),o.promise()},remove:function(e){var n;if(t.isObject(e)&&e instanceof i)n=e.id();else{if(!t.isNumber(e)&&!t.isString(e))throw"Invalid model specified.";n=e}}}),o.extend=n,o}),function(t,e){"function"==typeof define&&define.amd?define("ko.ninja",["underscore","knockout","ko.ninja.viewModel","ko.ninja.model","ko.ninja.collection"],e):e(t._,t.ko,t.ko.ninjaViewModel,t.ko.ninjaModel)}(this,function(t,e,i,n,r){return e.Collection=r,e.ViewModel=i,e.Model=n,e});